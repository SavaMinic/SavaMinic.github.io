"use strict";var Card=function(a){var b={container:".card__container",content:".card__content",clip:".clip"},c={containerClosed:"card__container--closed",bodyHidden:"body--hidden"},d=function(a,c){this.id=a,this._el=c,this._container=$(this._el).find(b.container)[0],this._clip=$(this._el).find(b.clip)[0],this._content=$(this._el).find(b.content)[0],this.isOpen=!1,this._TL=null};return d.prototype.openCard=function(a,b){this._TL=new TimelineLite;var c=this._slideContentDown(b),d=this._clipImageIn(b),e=this._floatContainer(a,b),g=(this._clipImageOut(b),this._slideContentUp(b));return this._TL.add(c),this._TL.add(d,0),this._TL.add(e,"-="+.6*d.duration()),this._TL.add(g),this.isOpen=!0,this._TL},d.prototype._slideContentDown=function(b){return TweenLite.to(this._content,b?.01:.8,{y:a.innerHeight,ease:Expo.easeInOut})},d.prototype._clipImageIn=function(a){var b=new TimelineLite,c=[[0,1200],[0,0],[1920,0],[1920,1200]],d=[[916,430],[1125,643],[960,607],[793,570]],e=[],f=a;return c.forEach(function(a,c){var g=TweenLite.to(a,f?.01:1.5,d[c]);d[c].onUpdate=function(){e.push(a.join()),e.length===d.length&&($(this._clip).attr("points",e.join(" ")),e=[])}.bind(this),g.vars.ease=Expo.easeInOut,b.add(g,0)},this),b},d.prototype._floatContainer=function(b,d){$(document.body).addClass(c.bodyHidden);var e=new TimelineLite,f=this._container.getBoundingClientRect(),g=a.innerWidth,h={width:0,x:f.left+f.width/2,y:f.top+f.height/2};return e.set(this._container,{width:f.width,height:f.height,x:f.left,y:f.top,position:"fixed",overflow:"hidden"}),e.to([this._container,h],d?.01:2,{width:g,height:"100%",x:g/2,y:0,xPercent:-50,ease:Expo.easeInOut,clearProps:"all",className:"-="+c.containerClosed,onUpdate:b.bind(this,h),onComplete:function(){$(this._container).addClass("card__container--fix-image")}.bind(this)}),e},d.prototype._clipImageOut=function(){var a=this._clipImageIn();return a.reverse(),a},d.prototype._slideContentUp=function(a){return TweenLite.to(this._content,a?.01:1,{y:0,clearProps:"all",ease:Expo.easeInOut})},d.prototype.closeCard=function(){return TweenLite.to(this._container,.4,{scrollTo:{y:0},onComplete:function(){$(this._container).css("overflow","hidden")}.bind(this),ease:Power2.easeOut}),this._TL.eventCallback("onReverseComplete",function(){TweenLite.set([this._container,this._content],{clearProps:"all"}),$(document.body).removeClass(c.bodyHidden),this.isOpen=!1}.bind(this)),this._TL.reverse()},d.prototype.hideCard=function(a){return TweenLite.to(this._el,a?.01:.4,{scale:.8,autoAlpha:0,transformOrigin:"center bottom",ease:Expo.easeInOut})},d.prototype.showCard=function(a){return TweenLite.to(this._el,a?.01:.5,{scale:1,autoAlpha:1,clearProps:"all",ease:Expo.easeInOut})},d}(window),demo=function(a){var b={pattern:".pattern",card:".card",cardImage:".card__image",cardClose:".card__btn-close"},c={patternHidden:"pattern--hidden",polygon:"polygon",polygonHidden:"polygon--hidden"},d={index:"data-index",id:"data-id"},e={paths:null,points:null},f={},g=function(){var b=Trianglify({width:a.innerWidth,height:a.innerHeight,cell_size:90,variance:1,stroke_width:1,x_colors:"random",y_colors:"random"}).svg();h(b),i(),q(),o("",p(location.href),!0)},h=function(a){$(b.pattern).append(a),e.paths=[].slice.call(a.childNodes),e.points=[],e.paths.forEach(function(a){$(a).attr("class",c.polygon);var b=a.getBoundingClientRect(),d={x:b.left+b.width/2,y:b.top+b.height/2};e.points.push(d)}),$(b.pattern).removeClass(c.patternHidden)},i=function(){var a=$(b.card);$.each(a,function(a,c){var e=new Card(c,a);f[c]={card:e};var g=$(a);g.attr(d.index,c+"");var h=g.find(b.cardImage),i=g.find(b.cardClose);$(h).on("click",function(){location.hash=g.attr(d.id)}),$(i).on("click",function(){location.hash=""})})},j=function(a,c,d){var e=f[c].card;if(!e.isOpen||!a){var g=new TimelineLite({paused:!0}),h=k(c,d);if(e.isOpen){var i=e.closeCard(),j=.8*i.duration();g.add(i),g.add(h,j)}else l($(this).find(b.cardImage).find("image")),g.add(h,h.duration()),g.add(e.openCard(m,d),0);g.play()}},k=function(a,b){var c=new TimelineLite,d=f[a].card;for(var e in f)if(f.hasOwnProperty(e)){var g=f[e].card;g.id===a||d.isOpen||c.add(g.hideCard(b),0),g.id!==a&&d.isOpen&&c.add(g.showCard(b),0)}return c},l=function(a){var c=$(a).attr("xlink:href");$(b.pattern).css("background-image","url("+c+")")},m=function(a){var b=a.width/2,d={x:a.x,y:a.y};e.points.forEach(function(a,f){n(a,b,d)?$(e.paths[f]).attr("class",c.polygon+" "+c.polygonHidden):$(e.paths[f]).attr("class",c.polygon)})},n=function(a,b,c){var d=a.x,e=a.y,f=c.x,g=c.y,h=b*b;return Math.pow(d-f,2)+Math.pow(e-g,2)<=h},o=function(a,b,c){var e=function(a){var b=$(a).attr(d.index);return parseInt(b,10)};if(a){var f=$("["+d.id+'="'+a+'"]')[0];f&&j.call(f,!1,e(f,c)),ga("send","event","NavigationFrom","click",a)}if(b){var g=$("["+d.id+'="'+b+'"]')[0];g&&j.call(g,!0,e(g),c),ga("send","event","NavigationTo","click",b),ga("send","pageview",b)}},p=function(a){var b=document.createElement("a");return b.href=a,b.hash.slice(1)},q=function(){a.addEventListener("hashchange",function(a){var b=p(a.newURL),c=p(a.oldURL);o(c,b)})};return{init:g}}(window);window.onload=demo.init;